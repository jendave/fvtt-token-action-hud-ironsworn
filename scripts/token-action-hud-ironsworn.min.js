const e={ID:"token-action-hud-ironsworn"},t={ID:"token-action-hud-core"},s="2.0",o={stat:"IRONSWORN.Stats"},n={stat:{id:"stat",name:"IRONSWORN.Stats",type:"system"},progress:{id:"progress",name:"IRONSWORN.ITEMS.SubtypeProgress",type:"system"},vow:{id:"vow",name:"IRONSWORN.ITEMS.SubtypeVow",type:"system"},connection:{id:"connection",name:"IRONSWORN.ITEMS.SubtypeConnection",type:"system"},path:{id:"path",name:"IRONSWORN.Asset Categories.Starforged.Path Assets.Title",type:"system"},companion:{id:"companion",name:"IRONSWORN.Asset Categories.Starforged.Companion Assets.Title",type:"system"},deed:{id:"deed",name:"IRONSWORN.Asset Categories.Starforged.Deed Assets.Title",type:"system"},module:{id:"module",name:"IRONSWORN.Asset Categories.Starforged.Module Assets.Title",type:"system"},supportVehicle:{id:"supportVehicle",name:"IRONSWORN.Asset Categories.Starforged.Support Vehicle Assets.Title",type:"system"},commandVehicle:{id:"commandVehicle",name:"IRONSWORN.Asset Categories.Starforged.Command Vehicle Assets.Title",type:"system"},ritual:{id:"ritual",name:"IRONSWORN.Asset Categories.Classic.Ritual Assets.Title",type:"system"},combatTalent:{id:"combatTalent",name:"IRONSWORN.Asset Categories.Classic.Combat Talent Assets.Title",type:"system"}},a={asset:{groupId:"asset"},progress:{groupId:"progress"},connection:{groupId:"connection"},vow:{groupId:"vow"},bondset:{groupId:"bondset"},path:{groupId:"path"},companion:{groupId:"companion"},ritual:{groupId:"ritual"},deed:{groupId:"deed"},module:{groupId:"module"},commandVehicle:{groupId:"commandVehicle"},supportVehicle:{groupId:"supportVehicle"},combatTalent:{groupId:"combatTalent"}},i={edge:"Edge",heart:"Heart",iron:"Iron",shadow:"Shadow",wits:"Wits"};let r=null;Hooks.once("tokenActionHudCoreApiReady",(async t=>{r=class Utils{static getSetting(s,o=null){let n=o??null;try{n=game.settings.get(e.ID,s)}catch{t.api.Logger.debug(`Setting '${s}' not found`)}return n}static async setSetting(s,o){try{o=await game.settings.set(e.ID,s,o),t.api.Logger.debug(`Setting '${s}' set to '${o}'`)}catch{t.api.Logger.debug(`Setting '${s}' not found`)}}}}));let c=null;Hooks.once("tokenActionHudCoreApiReady",(async e=>{c=class ActionHandler extends e.api.ActionHandler{a;async buildSystemActions(t){if(this.actors=this.actor?[this.actor]:this._getActors(),this.actorType=this.actor?.type,this.actor){let t=this.actor.items;t=e.api.Utils.sortItemsByName(t),this.items=t}"character"===this.actorType?this.#e():this.actor||this.#t()}#e(){this.#s(),this.#o()}#t(){}async#s(){if(0===this.items.size)return;const t="item",s=new Map;for(const[e,t]of this.items){let o=structuredClone(t);"progress"===o.type?"vow"===o.system.subtype?o.type="vow":"bond"===o.system.subtype&&(o.type="connection"):"asset"===o.type&&("Path"===o.system.category?o.type="path":"Companion"===o.system.category?o.type="companion":"Combat Talent"===o.system.category?o.type="combatTalent":"Ritual"===o.system.category?o.type="ritual":"Deed"===o.system.category?o.type="deed":"Module"===o.system.category?o.type="module":"Command Vehicle"===o.system.category?o.type="commandVehicle":"Support Vehicle"===o.system.category&&(o.type="supportVehicle"));const n=o.type,a=s.get(n)??new Map;a.set(e,o),s.set(n,a)}for(const[n,i]of s){const s=a[n]?.groupId;if(!s)continue;const r={id:s,type:"system"},c=[...i].map((([s,n])=>{const a=s,i=n.name,r=e.api.Utils.i18n(o[t]),c=`${r?`${r}: `:""}${i}`,l=[t,a].join(this.delimiter);return{id:a,name:i,listName:c,encodedValue:l}}));this.addActions(c,r)}}#o(){const t="stat",s=[];for(const n in i){const a=n,r=i[n],c=e.api.Utils.i18n(o[t]),l=`${c?`${c}: `:""}${r}`,d=[t,a].join(this.delimiter);s.push({id:a,name:r,listName:l,encodedValue:d})}this.addActions(s,{id:"stat",type:"system"})}}}));let l=null;Hooks.once("tokenActionHudCoreApiReady",(async e=>{const t=n;Object.values(t).forEach((t=>{t.name=e.api.Utils.i18n(t.name),t.listName=`Group: ${e.api.Utils.i18n(t.listName??t.name)}`}));const s=Object.values(t);l={layout:[{nestId:"asset",id:"asset",name:e.api.Utils.i18n("IRONSWORN.ITEMS.TypeAsset"),groups:[{...t.path,nestId:"asset_path"},{...t.companion,nestId:"asset_companion"},{...t.ritual,nestId:"asset_ritual"},{...t.deed,nestId:"asset_deed"},{...t.module,nestId:"asset_module"},{...t.commandVehicle,nestId:"asset_commandVehicle"},{...t.supportVehicle,nestId:"asset_supportVehicle"},{...t.combatTalent,nestId:"asset_combatTalent"}]},{nestId:"progress",id:"progress",name:e.api.Utils.i18n("IRONSWORN.ITEMS.SubtypeProgress"),groups:[{...t.progress,nestId:"progress_progress"},{...t.vow,nestId:"progress_vow"}]},{nestId:"connection",id:"connection",name:e.api.Utils.i18n("IRONSWORN.ITEMS.SubtypeConnection"),groups:[{...t.connection,nestId:"connection_connection"}]},{nestId:"stat",id:"stat",name:e.api.Utils.i18n("IRONSWORN.Stats"),groups:[{...t.stat,nestId:"stat_stat"}]}],groups:s}}));let d=null;function register(e){}Hooks.once("tokenActionHudCoreApiReady",(async e=>{d=class RollHandler extends e.api.RollHandler{async handleActionClick(e,t){const[s,o]=t.split("|");if(["item"].includes(s)&&this.isRenderItem())return this.doRenderItem(this.actor,o);const n=["character"];if(this.actor)return void await this.#n(e,this.actor,this.token,s,o);const a=canvas.tokens.controlled.filter((e=>n.includes(e.actor?.type)));for(const t of a){const n=t.actor;await this.#n(e,n,t,s,o)}}async handleActionHover(e,t){}async handleGroupClick(e,t){}async#n(e,t,s,o,n){switch(o){case"item":"progress"===t.items.get(n).type&&this.#a(e,t,n),this.#i(e,t,n);break;case"stat":this.#r(e,t,n);break;case"utility":this.#c(s,n)}}#a(e,t,s){CONFIG.IRONSWORN.applications.IronswornPrerollDialog.showForProgress(this.actor.items[s].name,t)}#i(e,t,s){t.items.get(s).sheet.render(!0)}#r(e,t,s){CONFIG.IRONSWORN.applications.IronswornPrerollDialog.showForStat(s,t)}async#c(e,t){if("endTurn"===t)game.combat?.current?.tokenId===e.id&&await(game.combat?.nextTurn())}}}));let p=null;Hooks.once("tokenActionHudCoreApiReady",(async t=>{p=class SystemManager extends t.api.SystemManager{getActionHandler(){return new c}getAvailableRollHandlers(){return{core:"Core Ironsworn"}}getRollHandler(e){let t;return t=new d,t}async registerDefaults(){return l}registerSettings(e){}registerStyles(){return{template:{class:"tah-style-template-style",file:"tah-template-style",moduleId:e.ID,name:"Template Style"}}}}})),Hooks.on("tokenActionHudCoreApiReady",(async()=>{const t=game.modules.get(e.ID);t.api={requiredCoreModuleVersion:"2.0",SystemManager:p},Hooks.call("tokenActionHudSystemReady",t)}));export{o as ACTION_TYPE,c as ActionHandler,t as CORE_MODULE,l as DEFAULTS,n as GROUP,a as ITEM_TYPE,e as MODULE,s as REQUIRED_CORE_MODULE_VERSION,d as RollHandler,i as STATS,p as SystemManager,r as Utils,register};
