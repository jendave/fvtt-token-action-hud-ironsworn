const e={ID:"token-action-hud-ironsworn"},t={ID:"token-action-hud-core"},o="2.0",s={stat:"IRONSWORN.Stats",meter:"tokenActionHud.ironsworn.meters",impact:"IRONSWORN.Impacts",utility:"tokenActionHud.utility",moveClassic:"IRONSWORN.ITEMS.TypeMove IRONSWORN.RULESETS.classic",moveDelve:"IRONSWORN.ITEMS.TypeMove IRONSWORN.RULESETS.delve",moveStarforged:"IRONSWORN.ITEMS.TypeMove IRONSWORN.RULESETS.starforged",moveSunderedIsles:"IRONSWORN.ITEMS.TypeMove IRONSWORN.RULESETS.sundered_isles"},r={stat:{id:"stat",name:"IRONSWORN.Stats",type:"system"},meter:{id:"meter",name:"tokenActionHud.ironsworn.meters",type:"system"},progress:{id:"progress",name:"IRONSWORN.ITEMS.SubtypeProgress",type:"system"},vow:{id:"vow",name:"IRONSWORN.ITEMS.SubtypeVow",type:"system"},connection:{id:"connection",name:"IRONSWORN.ITEMS.SubtypeConnection",type:"system"},path:{id:"path",name:"IRONSWORN.Asset Categories.Starforged.Path Assets.Title",type:"system"},companion:{id:"companion",name:"IRONSWORN.Asset Categories.Starforged.Companion Assets.Title",type:"system"},deed:{id:"deed",name:"IRONSWORN.Asset Categories.Starforged.Deed Assets.Title",type:"system"},module:{id:"module",name:"IRONSWORN.Asset Categories.Starforged.Module Assets.Title",type:"system"},supportVehicle:{id:"supportVehicle",name:"IRONSWORN.Asset Categories.Starforged.Support Vehicle Assets.Title",type:"system"},commandVehicle:{id:"commandVehicle",name:"IRONSWORN.Asset Categories.Starforged.Command Vehicle Assets.Title",type:"system"},ritual:{id:"ritual",name:"IRONSWORN.Asset Categories.Classic.Ritual Assets.Title",type:"system"},combatTalent:{id:"combatTalent",name:"IRONSWORN.Asset Categories.Classic.Combat Talent Assets.Title",type:"system"},misfortune:{id:"misfortune",name:"IRONSWORN.IMPACT.CATEGORY.Misfortunes",type:"system"},lastingEffect:{id:"lastingEffect",name:"IRONSWORN.IMPACT.CATEGORY.LastingEffects",type:"system"},burden:{id:"burden",name:"IRONSWORN.IMPACT.CATEGORY.Burdens",type:"system"},vehicleTrouble:{id:"vehicleTrouble",name:"IRONSWORN.IMPACT.CATEGORY.Vehicle",type:"system"},bane:{id:"bane",name:"IRONSWORN.DEBILITY.CATEGORY.Banes",type:"system"},condition:{id:"condition",name:"IRONSWORN.DEBILITY.CATEGORY.Conditions",type:"system"},utility:{id:"utility",name:"tokenActionHud.utility",type:"system"},sessionMoveStarforged:{id:"sessionMoveStarforged",name:"IRONSWORN.MOVES.Session Moves",type:"system",ruleset:"starforged"},adventureMoveStarforged:{id:"adventureMoveStarforged",name:"IRONSWORN.MOVES.Adventure Moves",type:"system",ruleset:"starforged"},questMoveStarforged:{id:"questMoveStarforged",name:"IRONSWORN.MOVES.Quest Moves",type:"system",ruleset:"starforged"},connectionMoveStarforged:{id:"connectionMoveStarforged",name:"IRONSWORN.MOVES.Connection Moves",type:"system",ruleset:"starforged"},explorationMoveStarforged:{id:"explorationMoveStarforged",name:"IRONSWORN.MOVES.Exploration Moves",type:"system",ruleset:"starforged"},combatMoveStarforged:{id:"combatMoveStarforged",name:"IRONSWORN.MOVES.Combat Moves",type:"system",ruleset:"starforged"},sufferMoveStarforged:{id:"sufferMoveStarforged",name:"IRONSWORN.MOVES.Suffer Moves",type:"system",ruleset:"starforged"},recoverMoveStarforged:{id:"recoverMoveStarforged",name:"IRONSWORN.MOVES.Recover Moves",type:"system",ruleset:"starforged"},thresholdMoveStarforged:{id:"thresholdMoveStarforged",name:"IRONSWORN.MOVES.Threshold Moves",type:"system",ruleset:"starforged"},legacyMoveStarforged:{id:"LegacyMoveStarforged",name:"IRONSWORN.MOVES.Legacy Moves",type:"system",ruleset:"starforged"},fateMoveStarforged:{id:"fateMoveStarforged",name:"IRONSWORN.MOVES.Fate Moves",type:"system",ruleset:"starforged"},sceneChallengeMoveStarforged:{id:"sceneChallengeMoveStarforged",name:"IRONSWORN.MOVES.Scene Challenge Moves",type:"system",ruleset:"starforged"},explorationMoveSunderedIsles:{id:"explorationMoveSunderedIsles",name:"IRONSWORN.MOVES.Exploration Moves",type:"system",ruleset:"sundered_isles"},combatMoveSunderedIsles:{id:"combatMoveSunderedIsles",name:"IRONSWORN.MOVES.Combat Moves",type:"system",ruleset:"sundered_isles"},sufferMoveSunderedIsles:{id:"sufferMoveSunderedIsles",name:"IRONSWORN.MOVES.Suffer Moves",type:"system",ruleset:"sundered_isles"},recoverMoveSunderedIsles:{id:"recoverMoveSunderedIsles",name:"IRONSWORN.MOVES.Recover Moves",type:"system",ruleset:"sundered_isles"},adventureMoveClassic:{id:"adventureMoveClassic",name:"IRONSWORN.MOVES.Adventure Moves",type:"system",ruleset:"classic"},relationshipMoveClassic:{id:"relationshipMoveClassic",name:"IRONSWORN.MOVES.Relationship Moves",type:"system",ruleset:"classic"},combatMoveClassic:{id:"combatMoveClassic",name:"IRONSWORN.MOVES.Combat Moves",type:"system",ruleset:"classic"},sufferMoveClassic:{id:"sufferMoveClassic",name:"IRONSWORN.MOVES.Suffer Moves",type:"system",ruleset:"classic"},questMoveClassic:{id:"questMoveClassic",name:"IRONSWORN.MOVES.Quest Moves",type:"system",ruleset:"classic"},fateMoveClassic:{id:"fateMoveClassic",name:"IRONSWORN.MOVES.Fate Moves",type:"system",ruleset:"classic"},delveMoveDelve:{id:"delveMoveDelve",name:"IRONSWORN.MOVES.Delve Moves",type:"system",ruleset:"delve"},failureMoveDelve:{id:"failureMoveDelve",name:"IRONSWORN.MOVES.Failure Moves",type:"system",ruleset:"delve"},threatMoveDelve:{id:"threatMoveDelve",name:"IRONSWORN.MOVES.Threat Moves",type:"system",ruleset:"delve"},rarityMoveDelve:{id:"rarityMoveDelve",name:"IRONSWORN.MOVES.Rarity Moves",type:"system",ruleset:"delve"}},n={asset:{groupId:"asset"},progress:{groupId:"progress"},connection:{groupId:"connection"},vow:{groupId:"vow"},bondset:{groupId:"bondset"},path:{groupId:"path"},companion:{groupId:"companion"},ritual:{groupId:"ritual"},deed:{groupId:"deed"},module:{groupId:"module"},commandVehicle:{groupId:"commandVehicle"},supportVehicle:{groupId:"supportVehicle"},combatTalent:{groupId:"combatTalent"}},a={edge:"IRONSWORN.Edge",heart:"IRONSWORN.Heart",iron:"IRONSWORN.Iron",shadow:"IRONSWORN.Shadow",wits:"IRONSWORN.Wits"},i={health:"IRONSWORN.Health",spirit:"IRONSWORN.Spirit",supply:"IRONSWORN.Supply",momentum:"IRONSWORN.Momentum",hold:"IRONSWORN.Hold"},d={wounded:{name:"IRONSWORN.IMPACT.Wounded",groupId:"misfortune"},shaken:{name:"IRONSWORN.IMPACT.Shaken",groupId:"misfortune"},unprepared:{name:"IRONSWORN.IMPACT.Unprepared",groupId:"misfortune"},permanentlyharmed:{name:"IRONSWORN.IMPACT.Permanentlyharmed",groupId:"lastingEffect"},traumatized:{name:"IRONSWORN.IMPACT.Traumatized",groupId:"lastingEffect"},doomed:{name:"IRONSWORN.IMPACT.Doomed",groupId:"burden"},tormented:{name:"IRONSWORN.IMPACT.Tormented",groupId:"burden"},indebted:{name:"IRONSWORN.IMPACT.Indebted",groupId:"burden"},battered:{name:"IRONSWORN.IMPACT.Battered",groupId:"vehicleTrouble"},cursed:{name:"IRONSWORN.IMPACT.Cursed",groupId:"vehicleTrouble"}},m={wounded:{name:"IRONSWORN.Debility.Wounded",groupId:"condition"},unprepared:{name:"IRONSWORN.Debility.Unprepared",groupId:"condition"},shaken:{name:"IRONSWORN.Debility.Shaken",groupId:"condition"},encumbered:{name:"IRONSWORN.Debility.Encumbered",groupId:"condition"},maimed:{name:"IRONSWORN.Debility.Maimed",groupId:"bane"},corrupted:{name:"IRONSWORN.Debility.Corrupted",groupId:"bane"},cursed:{name:"IRONSWORN.Debility.Cursed",groupId:"burden"},tormented:{name:"IRONSWORN.Debility.Tormented",groupId:"burden"}},l={battered:{name:"IRONSWORN.IMPACT.Battered",groupId:"vehicleTrouble"},cursed:{name:"IRONSWORN.IMPACT.Cursed",groupId:"vehicleTrouble"}},u={faceDanger:{name:"Face Danger",groupId:"adventureMoveClassic",uuid:"Compendium.foundry-ironsworn.ironswornmoves.Item.c8bacc17f73d3103",actionTypeId:"moveClassic"},aidYourAlly:{name:"Aid Your Ally",groupId:"relationshipMoveClassic",uuid:"Compendium.foundry-ironsworn.ironswornmoves.Item.f762e8f471fe875f",actionTypeId:"moveClassic"}},c={checkYourGear:{name:"Check Your Gear",groupId:"delveMoveDelve",uuid:"Compendium.foundry-ironsworn.ironsworndelvemoves.Item.48f642fd361e9c03",actionTypeId:"moveDelve"},delveTheDepths:{name:"Delve the Depths",groupId:"delveMoveDelve",uuid:"Compendium.foundry-ironsworn.ironsworndelvemoves.Item.36c6cbe556fbb639",actionTypeId:"moveDelve"},discoverASite:{name:"Discover a Site",groupId:"delveMoveDelve",uuid:"Compendium.foundry-ironsworn.ironsworndelvemoves.Item.e7ad42a1678725b9",actionTypeId:"moveDelve"},escapeTheDepths:{name:"Escape the Depths",groupId:"delveMoveDelve",uuid:"Compendium.foundry-ironsworn.ironsworndelvemoves.Item.313c82cede0ce9a7",actionTypeId:"moveDelve"},findAnOpportunity:{name:"Find an Opportunity",groupId:"delveMoveDelve",uuid:"Compendium.foundry-ironsworn.ironsworndelvemoves.Item.4da87fd54eaa1b89",actionTypeId:"moveDelve"},locateYourObjective:{name:"Locate Your Objective",groupId:"delveMoveDelve",uuid:"Compendium.foundry-ironsworn.ironsworndelvemoves.Item.2cd0d8934c6659fc",actionTypeId:"moveDelve"},revealADanger:{name:"Reveal a Danger",groupId:"delveMoveDelve",uuid:"Compendium.foundry-ironsworn.ironsworndelvemoves.Item.06f78b87b9532437",actionTypeId:"moveDelve"},revealADangerAlt:{name:"Reveal a Danger (alt)",groupId:"delveMoveDelve",uuid:"Compendium.foundry-ironsworn.ironsworndelvemoves.Item.c937a79dfda8095d",actionTypeId:"moveDelve"},learnFromYourFailures:{name:"Learn From Your Failures",groupId:"failureMoveDelve",uuid:"Compendium.foundry-ironsworn.ironsworndelvemoves.Item.d05ecfe8c467bdc5",actionTypeId:"moveDelve"},markYourFailure:{name:"Mark Your Failure",groupId:"failureMoveDelve",uuid:"Compendium.foundry-ironsworn.ironsworndelvemoves.Item.321c86f98e13f183",actionTypeId:"moveDelve"},wieldARarity:{name:"Wield a Rarity",groupId:"rarityMoveDelve",uuid:"Compendium.foundry-ironsworn.ironsworndelvemoves.Item.70c5da168f35295c",actionTypeId:"moveDelve"},advanceAThreat:{name:"Advance a Threat",groupId:"threatMoveDelve",uuid:"Compendium.foundry-ironsworn.ironsworndelvemoves.Item.03754df8933ca564",actionTypeId:"moveDelve"},takeAHiatus:{name:"Take a Hiatus",groupId:"threatMoveDelve",uuid:"Compendium.foundry-ironsworn.ironsworndelvemoves.Item.0cd7709d0a1545c9",actionTypeId:"moveDelve"}},p={enterTheFray:{name:"Enter the Fray",groupId:"combatMoveStarforged",uuid:"Compendium.foundry-ironsworn.starforgedmoves.Item.2f2ba4090b22a122",actionTypeId:"moveStarforged"},gainGround:{name:"Gain Ground",groupId:"combatMoveStarforged",uuid:"Compendium.foundry-ironsworn.starforgedmoves.Item.3f5a834fa3fea5d1",actionTypeId:"moveStarforged"},reactUnderFire:{name:"React Under Fire",groupId:"combatMoveStarforged",uuid:"Compendium.foundry-ironsworn.starforgedmoves.Item.d9208f9b7d827aec",actionTypeId:"moveStarforged"},strike:{name:"Strike",groupId:"combatMoveStarforged",uuid:"Compendium.foundry-ironsworn.starforgedmoves.Item.ae5994ceb3cba098",actionTypeId:"moveStarforged"},clash:{name:"Clash",groupId:"combatMoveStarforged",uuid:"Compendium.foundry-ironsworn.starforgedmoves.Item.723192c97fec4fe2",actionTypeId:"moveStarforged"},takeDecisiveAction:{name:"Take Decisive Action",groupId:"combatMoveStarforged",uuid:"Compendium.foundry-ironsworn.starforgedmoves.Item.3129f4caa4754caf",actionTypeId:"moveStarforged"},faceDefeat:{name:"Face Defeat",groupId:"combatMoveStarforged",uuid:"Compendium.foundry-ironsworn.starforgedmoves.Item.23ebe48d2b1a1d58",actionTypeId:"moveStarforged"},battle:{name:"Battle",groupId:"combatMoveStarforged",uuid:"Compendium.foundry-ironsworn.starforgedmoves.Item.a903d120af3b1475",actionTypeId:"moveStarforged"},swearIronVow:{name:"Swear an Iron Vow",groupId:"questMoveStarforged",uuid:"Compendium.foundry-ironsworn.starforgedmoves.Item.9c9ab6a42daa96e0",actionTypeId:"moveStarforged"},reachMilestone:{name:"Reach a Milestone",groupId:"questMoveStarforged",uuid:"Compendium.foundry-ironsworn.starforgedmoves.Item.0d7f13818c1c19ed",actionTypeId:"moveStarforged"}},v={enterTheFray:{name:"Enter the Fray",groupId:"combatMoveSunderedIsles",uuid:"Compendium.foundry-ironsworn.sunderedislesmoves.Item.24dfbbb42bceb9f8",actionTypeId:"moveSunderedIsles"},confrontChaos:{name:"Confront Chaos",groupId:"explorationMoveSunderedIsles",uuid:"Compendium.foundry-ironsworn.sunderedislesmoves.Item.4265fe492d629800",actionTypeId:"moveSunderedIsles"},makeADiscovery:{name:"Make a Discovery",groupId:"explorationMoveSunderedIsles",uuid:"Compendium.foundry-ironsworn.sunderedislesmoves.Item.d5927e1450bfbbca",actionTypeId:"moveSunderedIsles"},setACourse:{name:"Set a Course",groupId:"explorationMoveSunderedIsles",uuid:"Compendium.foundry-ironsworn.sunderedislesmoves.Item.7cb0a8ade5f31444",actionTypeId:"moveSunderedIsles"},undertakeAnExpedition:{name:"Undertake an Expedition",groupId:"explorationMoveSunderedIsles",uuid:"Compendium.foundry-ironsworn.sunderedislesmoves.Item.d80a8e734bed435b",actionTypeId:"moveSunderedIsles"},repair:{name:"Repair",groupId:"recoverMoveSunderedIsles",uuid:"Compendium.foundry-ironsworn.sunderedislesmoves.Item.8a164fecb3029c76",actionTypeId:"moveSunderedIsles"},resupply:{name:"Resupply",groupId:"recoverMoveSunderedIsles",uuid:"Compendium.foundry-ironsworn.sunderedislesmoves.Item.c96bafd5cbda43bc",actionTypeId:"moveSunderedIsles"},withstandDamage:{name:"Withstand Damage",groupId:"sufferMoveSunderedIsles",uuid:"Compendium.foundry-ironsworn.sunderedislesmoves.Item.a03a648bb3a06d93",actionTypeId:"moveSunderedIsles"}};let I=null;Hooks.once("tokenActionHudCoreApiReady",(async e=>{I=class ActionHandler extends e.api.ActionHandler{a;async buildSystemActions(t){if(this.actors=this.actor?[this.actor]:this._getActors(),this.actorType=this.actor?.type,this.actor){let t=this.actor.items;t=e.api.Utils.sortItemsByName(t),this.items=t}"character"===this.actorType?this.#e():"starship"===this.actorType?this.#t():"shared"===this.actorType&&this.#o()}#e(){this.#s(),this.#r(),this.#n(),this.#a(),this.#i()}#t(){this.#a(!0)}#o(){this.#s()}async#s(){if(0===this.items.size)return;const t="item",o=new Map;for(const[e,t]of this.items){const s=structuredClone(t);"progress"===s.type?"vow"===s.system.subtype?s.type="vow":"bond"===s.system.subtype&&(s.type="connection"):"asset"===s.type&&("Path"===s.system.category?s.type="path":"Companion"===s.system.category?s.type="companion":"Combat Talent"===s.system.category?s.type="combatTalent":"Ritual"===s.system.category?s.type="ritual":"Deed"===s.system.category?s.type="deed":"Module"===s.system.category?s.type="module":"Command Vehicle"===s.system.category?s.type="commandVehicle":"Support Vehicle"===s.system.category&&(s.type="supportVehicle"));const r=s.type,n=o.get(r)??new Map;n.set(e,s),o.set(r,n)}for(const[r,a]of o){const o=n[r]?.groupId;if(!o)continue;const i={id:o,type:"system"},d=[...a].map((([o,r])=>{const n=o,a=r.name,i=e.api.Utils.i18n(s[t]),d=`${i?`${i}: `:""}${a}`,m=[t,n].join(this.delimiter);return{id:n,name:a,listName:d,encodedValue:m,info1:"progress"===r.type||"vow"===r.system.subtype||"connection"===r.type?{text:Math.floor(r.system.current/4).toString()}:null}}));this.addActions(d,i)}}#r(){const t="stat",o=[];for(const r in a){const n=r,i=e.api.Utils.i18n(a[r]).charAt(0).toUpperCase()+e.api.Utils.i18n(a[r]).slice(1),d=e.api.Utils.i18n(s[t]),m=`${d?`${d}: `:""}${i}`,l=[t,n].join(this.delimiter),u={text:this.actor.system[r]};o.push({id:n,name:i,listName:m,encodedValue:l,info1:u})}this.addActions(o,{id:"stat",type:"system"})}#n(){const t="meter",o=[];for(const r in i){const n=r;if("hold"==r&&!game.settings.get("foundry-ironsworn","character-hold"))continue;const a=e.api.Utils.i18n(i[r]).charAt(0).toUpperCase()+e.api.Utils.i18n(i[r]).slice(1),d=e.api.Utils.i18n(s[t]),m=`${d?`${d}: `:""}${a}`,l=[t,n].join(this.delimiter),u={text:this.actor.system[r].value};o.push({id:n,name:a,listName:m,encodedValue:l,info1:u})}this.addActions(o,{id:"meter",type:"system"})}async#a(t){const o="impact",r=new Map;let n;n="ironsworn.IronswornCharacterSheetV2"===this.actor.flags.core?.sheetClass?m:t?l:d;for(const e in n)if(n.hasOwnProperty(e)){const t=n[e],o=r.get(t.groupId)??new Map;o.set(e,t.groupId),r.set(t.groupId,o)}for(const[t,a]of r){if(!t)continue;const r={id:t,type:"system"},i=[...a].map((([t])=>{const r=t,a=e.api.Utils.i18n(n[t].name).charAt(0).toUpperCase()+e.api.Utils.i18n(n[t].name).slice(1),i=e.api.Utils.i18n(s[o]),d=`${i?`${i}: `:""}${a}`,m=[o,r].join(this.delimiter);return{id:r,name:a,listName:d,encodedValue:m,info1:{text:this.actor.system.debility[t]?"🔘":null}}}));this.addActions(i,r)}}async#i(){const e=[u,c,p,v];for(const t of e){const e=new Map;let o=t;for(const t in o)if(o.hasOwnProperty(t)){const s=o[t],r=e.get(s.groupId)??new Map;r.set(t,s.groupId),e.set(s.groupId,r)}for(const[t,s]of e){if(!t)continue;const e={id:t,type:"system"},r=[...s].map((([e])=>{const t=e,s=o[e].name,r=o[e].actionTypeId,n=`${r?`${r}: `:""}${s}`,a=[o[e].actionTypeId,t].join(this.delimiter);return{id:t,name:s,listName:n,encodedValue:a}}));this.addActions(r,e)}}}}}));let y=null;Hooks.once("tokenActionHudCoreApiReady",(async e=>{const t=r;Object.values(t).forEach((t=>{t.name=e.api.Utils.i18n(t.name),t.listName=`Group: ${e.api.Utils.i18n(t.listName??t.name)}`}));const o=Object.values(t);y={layout:[{nestId:"asset",id:"asset",name:e.api.Utils.i18n("IRONSWORN.ITEMS.TypeAsset"),groups:[{...t.path,nestId:"asset_path"},{...t.companion,nestId:"asset_companion"},{...t.ritual,nestId:"asset_ritual"},{...t.deed,nestId:"asset_deed"},{...t.module,nestId:"asset_module"},{...t.commandVehicle,nestId:"asset_commandVehicle"},{...t.supportVehicle,nestId:"asset_supportVehicle"},{...t.combatTalent,nestId:"asset_combatTalent"}]},{nestId:"progress",id:"progress",name:e.api.Utils.i18n("IRONSWORN.ITEMS.SubtypeProgress"),groups:[{...t.progress,nestId:"progress_progress"},{...t.vow,nestId:"progress_vow"}]},{nestId:"connection",id:"connection",name:e.api.Utils.i18n("IRONSWORN.ITEMS.SubtypeConnection"),groups:[{...t.connection,nestId:"connection_connection"}]},{nestId:"stat",id:"stat",name:e.api.Utils.i18n("IRONSWORN.Stats"),groups:[{...t.stat,nestId:"stat_stat"}]},{nestId:"meter",id:"meter",name:e.api.Utils.i18n("tokenActionHud.ironsworn.meters"),groups:[{...t.meter,nestId:"meter_meter"}]},{nestId:"impact",id:"impact",name:e.api.Utils.i18n("IRONSWORN.Impacts"),groups:[{...t.misfortune,nestId:"impact_misfortune"},{...t.lastingEffect,nestId:"impact_lastingEffect"},{...t.burden,nestId:"impact_burden"},{...t.vehicleTrouble,nestId:"impact_vehicleTrouble"},{...t.bane,nestId:"impact_bane"},{...t.condition,nestId:"impact_condition"}]},{nestId:"utility",id:"utility",name:e.api.Utils.i18n("tokenActionHud.utility"),groups:[{...t.combat,nestId:"utility_combat"},{...t.token,nestId:"utility_token"},{...t.rests,nestId:"utility_rests"},{...t.utility,nestId:"utility_utility"}]},{nestId:"moveClassic",id:"moveClassic",name:e.api.Utils.i18n("IRONSWORN.ITEMS.TypeMove")+" "+e.api.Utils.i18n("IRONSWORN.RULESETS.classic"),groups:[{...t.adventureMoveClassic,nestId:"move_adventureMoveClassic"},{...t.combatMoveClassic,nestId:"move_combatMoveClassic"},{...t.fateMoveClassic,nestId:"move_fateMoveClassic"},{...t.questMoveClassic,nestId:"move_questMoveClassic"},{...t.relationshipMoveClassic,nestId:"move_relationshipMoveClassic"},{...t.sufferMoveClassic,nestId:"move_sufferMoveClassic"}]},{nestId:"moveDelve",id:"moveDelve",name:e.api.Utils.i18n("IRONSWORN.ITEMS.TypeMove")+" "+e.api.Utils.i18n("IRONSWORN.RULESETS.delve"),groups:[{...t.delveMoveDelve,nestId:"move_delveMoveDelve"},{...t.failureMoveDelve,nestId:"move_failureMoveDelve"},{...t.threatMoveDelve,nestId:"move_threatMoveDelve"},{...t.rarityMoveDelve,nestId:"move_rarityMoveDelve"}]},{nestId:"moveStarforged",id:"moveStarforged",name:e.api.Utils.i18n("IRONSWORN.ITEMS.TypeMove")+" "+e.api.Utils.i18n("IRONSWORN.RULESETS.starforged"),groups:[{...t.adventureMoveStarforged,nestId:"move_adventureMoveStarforged"},{...t.combatMoveStarforged,nestId:"move_combatMoveStarforged"},{...t.connectionMoveStarforged,nestId:"move_connectionMoveStarforged"},{...t.explorationMoveStarforged,nestId:"move_explorationMoveStarforged"},{...t.fateMoveStarforged,nestId:"move_fateMoveStarforged"},{...t.legacyMoveStarforged,nestId:"move_legacyMoveStarforged"},{...t.questMoveStarforged,nestId:"move_questMoveStarforged"},{...t.recoverMoveStarforged,nestId:"move_recoverMoveStarforged"},{...t.sceneChallengeMoveStarforged,nestId:"move_sceneChallengeMoveStarforged"},{...t.sessionMoveStarforged,nestId:"move_sessionMoveStarforged"},{...t.sufferMoveStarforged,nestId:"move_sufferMoveStarforged"},{...t.thresholdMoveStarforged,nestId:"move_thresholdMoveStarforged"}]},{nestId:"moveSunderedIsles",id:"moveSunderedIsles",name:e.api.Utils.i18n("IRONSWORN.ITEMS.TypeMove")+" "+e.api.Utils.i18n("IRONSWORN.RULESETS.sundered_isles"),groups:[{...t.combatMoveSunderedIsles,nestId:"move_combatMoveSunderedIsles"},{...t.explorationMoveSunderedIsles,nestId:"move_explorationMoveSunderedIsles"},{...t.recoverMoveSunderedIsles,nestId:"move_recoverMoveSunderedIsles"},{...t.sufferMoveSunderedIsles,nestId:"move_sufferMoveSunderedIsles"}]}],groups:o}}));let S=null;function register(e){}Hooks.once("tokenActionHudCoreApiReady",(async e=>{S=class RollHandler extends e.api.RollHandler{async handleActionClick(e,t){const[o,s]=t.split("|");if(["item"].includes(o)&&this.isRenderItem())return this.doRenderItem(this.actor,s);const r=["character","starship"];if(this.actor)return void await this.#d(e,this.actor,this.token,o,s);const n=canvas.tokens.controlled.filter((e=>r.includes(e.actor?.type)));for(const t of n){const r=t.actor;await this.#d(e,r,t,o,s)}}async handleActionHover(e,t){}async handleGroupClick(e,t){}async#d(e,t,o,s,r){switch(s){case"item":"progress"===t.items.get(r).type&&this.#m(e,t,r),this.#l(e,t,r);break;case"stat":this.#u(e,t,r);break;case"meter":this.#c(e,t,r);break;case"impact":this.#p(e,t,r);break;case"utility":this.#v(o,r);break;case"moveClassic":case"moveDelve":case"moveStarforged":case"moveSunderedIsles":this.#I(o,t,o,r,s)}}#m(e,t,o){t.items.get(o).sheet.render(!0)}#l(e,t,o){t.items.get(o).sheet.render(!0)}#u(e,t,o){CONFIG.IRONSWORN.applications.IronswornPrerollDialog.showForStat(o,t)}#c(e,t,o){"momentum"!==o&&CONFIG.IRONSWORN.applications.IronswornPrerollDialog.showForStat(o,t)}async#p(e,t,o){const s={system:{debility:{[o]:!t.system.debility[o]}}};await t.update(s),Hooks.call("tokenActionHudCoreApiReady",t)}async#v(e,t){if("endTurn"===t)game.combat?.current?.tokenId===e.id&&await(game.combat?.nextTurn())}async#I(e,t,o,s,r){let n;switch(r){case"moveClassic":n=u;break;case"moveDelve":n=c;break;case"moveStarforged":n=p;break;case"moveSunderedIsles":n=v}await(t.moveSheet?.render(!0)),CONFIG.IRONSWORN.emitter.emit("highlightMove",n[s].uuid)}}}));let g=null;Hooks.once("tokenActionHudCoreApiReady",(async t=>{g=class SystemManager extends t.api.SystemManager{getActionHandler(){return new I}getAvailableRollHandlers(){return{core:"Core Ironsworn"}}getRollHandler(e){let t;return t=new S,t}async registerDefaults(){return y}registerSettings(e){}registerStyles(){return{template:{class:"tah-style-template-style",file:"tah-template-style",moduleId:e.ID,name:"Template Style"}}}}})),Hooks.on("tokenActionHudCoreApiReady",(async()=>{const t=game.modules.get(e.ID);t.api={requiredCoreModuleVersion:"2.0",SystemManager:g},Hooks.call("tokenActionHudSystemReady",t)}));let f=null;Hooks.once("tokenActionHudCoreApiReady",(async t=>{f=class Utils{static getSetting(o,s=null){let r=s??null;try{r=game.settings.get(e.ID,o)}catch{t.api.Logger.debug(`Setting '${o}' not found`)}return r}static async setSetting(o,s){try{s=await game.settings.set(e.ID,o,s),t.api.Logger.debug(`Setting '${o}' set to '${s}'`)}catch{t.api.Logger.debug(`Setting '${o}' not found`)}}}}));export{s as ACTION_TYPE,I as ActionHandler,t as CORE_MODULE,y as DEFAULTS,r as GROUP,m as IMPACTS_IS,d as IMPACTS_SF,l as IMPACTS_STARSHIP,n as ITEM_TYPE,i as METERS,e as MODULE,u as MOVES_CLASSIC,c as MOVES_DELVE,p as MOVES_STARFORGED,v as MOVES_SUNDERED_ISLES,o as REQUIRED_CORE_MODULE_VERSION,S as RollHandler,a as STATS,g as SystemManager,f as Utils,register};
